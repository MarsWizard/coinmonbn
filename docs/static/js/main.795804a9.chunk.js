(this.webpackJsonpmpui=this.webpackJsonpmpui||[]).push([[0],{138:function(t,e,a){},189:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a(45),s=a.n(r),c=(a(138),a(27)),o=a(80),i=a(81),l=a(15),u=a(84),d=a(83),h=a(103),b=a.n(h),f=a(51),p=a(18),y=a(5);function C(t){return null==t?"":t.contractCode}var v=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(t){var n;return Object(o.a)(this,a),(n=e.call(this,t)).state={nearContract:null,farContract:null,contractsDailySeries:{},nearContractDailySeries:null},n.futureWsClient=t.futureWsClient,n.swapWsClient=t.swapWsClient,console.log(t),n.setNearContract=n.setNearContract.bind(Object(l.a)(n)),n.setFarContract=n.setFarContract.bind(Object(l.a)(n)),n.setContracts=n.setContracts.bind(Object(l.a)(n)),n.nearContractCode=n.nearContractCode.bind(Object(l.a)(n)),n.dataToEvents=n.dataToEvents.bind(Object(l.a)(n)),n}return Object(i.a)(a,[{key:"nearContractCode",value:function(){var t=this.state.nearContract;return null==t?"":t.contractCode}},{key:"setNearContract",value:function(t){console.log(t),this.setState({nearContract:t})}},{key:"setFarContract",value:function(t){console.log(t),this.setState({farContract:t})}},{key:"setContracts",value:function(t,e){this.setState({nearContract:t,farContract:e});var a=Date.now();console.log(this.futureWsClient),this.sendQuery(t.contractCode,"1day",Math.floor(a/1e3-86400),Math.floor(a/1e3),this.futureWsClient)}},{key:"sendQuery",value:function(t,e,a,n,r){JSON.stringify({req:"market.".concat(t,".kline.").concat(e),id:"id4",from:a,to:n})}},{key:"dataToEvents",value:function(t){return t.map((function(t,e){return new p.TimeEvent(new Date(1e3*t.id),t)}))}},{key:"updateData",value:function(t){console.log(t);var e=t.rep.match(/market\.([\w\-_]+)\.kline\.1day/);if(null!=e){var a=e[1],n=this.state.contractsDailySeries;n[a]=t.data;var r=this.state.nearContractDailySeries;null!=this.state.nearContract&&a==this.state.nearContract.contractCode&&(r=new p.TimeSeries({name:"near contract daily price",columns:["time","close"],events:this.dataToEvents(t.data)})),this.setState({contractsDailySeries:n,nearContractDailySeries:r})}}},{key:"render",value:function(){var t=this.state.contractsDailySeries[this.nearContractCode()],e=null;if(null!=t&&t.length>0){var a=this.state.nearContractDailySeries;e=Object(y.jsxs)("div",{children:[Object(y.jsxs)("h2",{children:[this.state.nearContract.contractCode," Close"]}),Object(y.jsx)(f.ChartContainer,{width:800,timeRange:a.range(),children:Object(y.jsxs)(f.ChartRow,{height:"200",children:[Object(y.jsx)(f.YAxis,{id:"price",label:"Price ($)",min:0,max:a.max("close"),width:"60",format:"$,.2f"}),Object(y.jsx)(f.Charts,{children:Object(y.jsx)(f.LineChart,{columns:["close"],axis:"price",series:a})})]})})]})}return Object(y.jsxs)("div",{children:[Object(y.jsxs)("h2",{children:[C(this.state.nearContract)," vs ",C(this.state.farContract)]}),e]})}}]),a}(n.Component),j=a(131),m=a(188);function O(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return Number.parseFloat(t).toPrecision(e)}var k=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(t){var n;Object(o.a)(this,a),n=e.call(this,t);for(var r={},s=["ETH","BTC"],i=0,u=s;i<u.length;i++){r[u[i]]=null}for(var d=["-USD","_CW","_NW","_CQ","_NQ"],h=[],b={},f=0,p=s;f<p.length;f++){var y,C=p[f],v=[],j=Object(c.a)(d);try{for(j.s();!(y=j.n()).done;){var m={contractCode:C+y.value};h.push(m),v.push(m)}}catch(O){j.e(O)}finally{j.f()}b[C]=v}return n.state={count:90,prices:r,symbols:s,future_contracts:[{contract_code:"ETH_CW",symbol:"ETH"},{contract_code:"ETH_NW",symbol:"ETH"},{contract_code:"ETH_CQ",symbol:"ETH"},{contract_code:"ETH_NQ",symbol:"ETH"},{contract_code:"BTC_CW",symbol:"BTC"},{contract_code:"BTC_NW",symbol:"BTC"},{contract_code:"BTC_CQ",symbol:"BTC"},{contract_code:"BTC_NQ",symbol:"BTC"}],historyData:{},currentPair:null,contracts:h,symbolContracts:b,openPrices:{},baseAssets:["ETH","BTC","LTC"]},n.sendMessage=n.sendMessage.bind(Object(l.a)(n)),n.subscribe=n.subscribe.bind(Object(l.a)(n)),n.updatePrice=n.updatePrice.bind(Object(l.a)(n)),n.sendMessageSwap=n.sendMessageSwap.bind(Object(l.a)(n)),n.queryFutureKlineData=n.queryFutureKlineData.bind(Object(l.a)(n)),n.onClickMarketData=n.onClickMarketData.bind(Object(l.a)(n)),n.compareContracts=n.compareContracts.bind(Object(l.a)(n)),n.updateOpenPrice=n.updateOpenPrice.bind(Object(l.a)(n)),n.deliverySymbolsLoaded=n.deliverySymbolsLoaded.bind(Object(l.a)(n)),n.subscribeDeliveryContracts=n.subscribeDeliveryContracts.bind(Object(l.a)(n)),n.fetchMarketData=n.fetchMarketData.bind(Object(l.a)(n)),n}return Object(i.a)(a,[{key:"queryFutureKlineData",value:function(t,e,a,n){var r=JSON.stringify({req:"market.".concat(t,".kline.").concat(e),id:"id4",from:a,to:n});this.sendMessage(r),this.sendMessageSwap(r)}},{key:"onClickMarketData",value:function(){console.log("onClickMarketData"),this.queryFutureKlineData("ETH_CQ","1min",0,1)}},{key:"componentDidMount",value:function(){var t,e=Object(c.a)(this.state.symbols);try{for(e.s();!(t=e.n()).done;)t.value}catch(n){e.e(n)}finally{e.f()}var a=this;fetch("https://dapi.binance.com/dapi/v1/exchangeInfo").then((function(t){return t.json()})).then((function(t){a.setState({symbols:t.symbols}),a.deliverySymbolsLoaded()}))}},{key:"deliverySymbolsLoaded",value:function(){var t,e=this.state.symbolContracts,a=this.state.contracts,n=["PERPETUAL","CURRENT_QUARTER","NEXT_QUARTER"],r=Object(c.a)(this.state.baseAssets);try{for(r.s();!(t=r.n()).done;){var s,o=t.value,i=[],l=Object(c.a)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value,d={pair:o+"USD",contractCode:o+"USD_"+u,contractType:u};a.push(d),i.push(d)}}catch(h){l.e(h)}finally{l.f()}e[o]=i}}catch(h){r.e(h)}finally{r.f()}this.refWebSocket.url="wss://dstream.binance.com/stream?streams/btcusd_210924@kline_1m/btcusd_210625@kline_1m",this.refWebSocket.setupWebsocket(),this.setState({symbolContracts:e})}},{key:"fetchMarketData",value:function(t,e,a){var n=new URL("https://dapi.binance.com/dapi/v1/continuousKlines"),r={pair:t,contractType:e,interval:a,limit:1500};return Object.keys(r).forEach((function(t){return n.searchParams.append(t,r[t])})),fetch(n).then((function(t){return t.json()}))}},{key:"subscribeDeliveryContracts",value:function(){var t,e=this.state.symbols,a=Object(c.a)(e);try{for(a.s();!(t=a.n()).done;){var n=t.value,r="market.".concat(n.symbol,"@kline_1m");r=r.toLowerCase()}}catch(s){a.e(s)}finally{a.f()}}},{key:"handleData",value:function(t){var e=JSON.parse(t).data,a=e.ps+"_"+e.ct;this.updatePrice(a,parseFloat(e.k.c)),this.updateOpenPrice(a,parseFloat(e.k.o))}},{key:"updatePrice",value:function(t,e){var a=this.state.prices;a[t]=e,this.setState({prices:a})}},{key:"subscribe",value:function(){var t,e=Object(c.a)(this.state.symbols);try{for(e.s();!(t=e.n()).done;)for(var a=t.value,n=0,r=["CW","NW","CQ","NQ"];n<r.length;n++){var s=r[n];this.sendMessage(JSON.stringify({sub:"market.".concat(a,"_").concat(s,".kline.1day"),id:"".concat(a,"_").concat(s)}))}}catch(o){e.e(o)}finally{e.f()}}},{key:"handleOpen",value:function(){this.subscribeDeliveryContracts()}},{key:"sendMessage",value:function(t){this.refWebSocket.sendMessage(t)}},{key:"handleSwapOpen",value:function(){var t,e=new Set,a=Object(c.a)(this.state.future_contracts);try{for(a.s();!(t=a.n()).done;){var n=t.value;e.add(n.symbol)}}catch(u){a.e(u)}finally{a.f()}var r,s=Object(c.a)(e);try{for(s.s();!(r=s.n()).done;){var o=r.value,i="".concat(o,"-USD"),l="market.".concat(i,".kline.1day");this.sendMessageSwap(JSON.stringify({sub:l}))}}catch(u){s.e(u)}finally{s.f()}}},{key:"sendMessageSwap",value:function(t){this.ws_swap.sendMessage(t)}},{key:"updateOpenPrice",value:function(t,e){var a=this.state.openPrices;a[t]=e,this.setState({openPrices:a})}},{key:"handleSwapReceive",value:function(t){var e=this;t.arrayBuffer().then((function(t){var a=m.inflate(t,{to:"string"}),n=JSON.parse(a);if(n.ping)e.sendMessageSwap(JSON.stringify({pong:n.ping}));else if(n.tick){var r=n.ch.match(/market\.(([\w]+)\-([\w+]+))\.kline\.(.*)/);if(r){var s=r[2],c=r[1];"1day"==r[4]&&e.updateOpenPrice(c,n.tick.open),e.updatePrice(s,n.tick.close),e.updatePrice(c,n.tick.close)}else n.req&&e.compareView.updateData(n)}}))}},{key:"compareContracts",value:function(t,e){var a=this,n=(t.contractCode,e.contractCode,this),r=null,s=null;this.fetchMarketData(t.pair,t.contractType,"1m").then((function(t){return r=t})).then((function(){return a.fetchMarketData(e.pair,e.contractType,"1m")})).then((function(t){return s=t})).then((function(){console.log(r),console.log(s);for(var t=r,e=[["Currency Name","rate"]],a=0;a<t.length;a+=1)e.push([new Date(t[a][0]),parseFloat(t[a][4])/parseFloat(s[a][4])]);n.setState({historyData:e})})),this.compareView.setContracts(t,e);var c=Date.now();Math.floor(c/1e3-1209600),Math.floor(c/1e3)}},{key:"render",value:function(){var t,e=this,a=(this.state.symbols,this.state.future_contracts,this.state.symbolContracts),n=[],r=Object(c.a)(this.state.baseAssets);try{for(r.s();!(t=r.n()).done;)for(var s=t.value,o=0,i=["perpetual","next_quarter","current_quarter"];o<i.length;o++){var l=i[o],u="".concat(s.toLowerCase(),"usd_").concat(l,"@continuousKline_1d");n.push(u)}}catch(f){r.e(f)}finally{r.f()}var d="wss://dstream.binance.com/stream?streams="+n.join("/"),h=Object(y.jsx)(b.a,{url:d,onMessage:this.handleData.bind(this),debug:!0,onOpen:this.handleOpen.bind(this),ref:function(t){e.refWebSocket=t}});return Object(y.jsxs)("div",{children:[Object.keys(a).map((function(t,n){return Object(y.jsxs)("table",{symbol:t,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{}),Object(y.jsx)("td",{}),a[t].map((function(t,e){return Object(y.jsx)("td",{children:t.contractCode},t.contractCode)}))]})}),Object(y.jsx)("tbody",{children:a[t].map((function(n,r){return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:n.contractCode}),Object(y.jsxs)("td",{children:[O(e.state.prices[n.contractCode]),"(",O(100*(e.state.prices[n.contractCode]/e.state.openPrices[n.contractCode]-1),3),"%)"]}),a[t].map((function(t,a){return Object(y.jsxs)("td",{onClick:function(){return e.compareContracts(n,t)},children:[(e.state.prices[n.contractCode]-e.state.prices[t.contractCode]).toFixed(4),"(",(e.state.prices[n.contractCode]/e.state.prices[t.contractCode]).toFixed(4),")"]})}))]},n.contract)}))})]})})),h,Object(y.jsx)(b.a,{url:"wss://api.btcgateway.pro/swap-ws",onMessage:this.handleSwapReceive.bind(this),debug:!0,onOpen:this.handleSwapOpen.bind(this),ref:function(t){e.ws_swap=t}}),Object(y.jsx)(v,{ref:function(t){return e.compareView=t},futureWsClient:h,swapWsClient:this.ws_swap}),Object(y.jsx)(j.a,{width:"600px",height:"400px",chartType:"LineChart",loader:Object(y.jsx)("div",{children:"Loading Chart"}),data:this.state.historyData,options:{series:{0:{axis:"Price"},1:{axis:"Price"},2:{axis:"Rate"}},axes:{y:{Price:{label:"Price"},Rate:{label:"Rate"}}}},rootProps:{"data-testid":"1"}})]})}}]),a}(n.Component),g=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,191)).then((function(e){var a=e.getCLS,n=e.getFID,r=e.getFCP,s=e.getLCP,c=e.getTTFB;a(t),n(t),r(t),s(t),c(t)}))};s.a.render(Object(y.jsx)(k,{}),document.getElementById("root")),g()}},[[189,1,2]]]);
//# sourceMappingURL=main.795804a9.chunk.js.map