(this.webpackJsonpmpui=this.webpackJsonpmpui||[]).push([[0],{136:function(t,e,a){},187:function(t,e,a){"use strict";a.r(e);var n=a(2),c=a(44),r=a.n(c),s=(a(136),a(51)),i=a(80),o=a(81),l=a(17),u=a(84),d=a(83),h=a(103),b=a.n(h),f=a(50),p=a(18),C=a(5);function y(t){return null==t?"":t.contractCode}var v=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(t){var n;return Object(i.a)(this,a),(n=e.call(this,t)).state={nearContract:null,farContract:null,contractsDailySeries:{},nearContractDailySeries:null},n.futureWsClient=t.futureWsClient,n.swapWsClient=t.swapWsClient,console.log(t),n.setNearContract=n.setNearContract.bind(Object(l.a)(n)),n.setFarContract=n.setFarContract.bind(Object(l.a)(n)),n.setContracts=n.setContracts.bind(Object(l.a)(n)),n.nearContractCode=n.nearContractCode.bind(Object(l.a)(n)),n.dataToEvents=n.dataToEvents.bind(Object(l.a)(n)),n}return Object(o.a)(a,[{key:"nearContractCode",value:function(){var t=this.state.nearContract;return null==t?"":t.contractCode}},{key:"setNearContract",value:function(t){console.log(t),this.setState({nearContract:t})}},{key:"setFarContract",value:function(t){console.log(t),this.setState({farContract:t})}},{key:"setContracts",value:function(t,e){this.setState({nearContract:t,farContract:e});var a=Date.now();console.log(this.futureWsClient),this.sendQuery(t.contractCode,"1day",Math.floor(a/1e3-86400),Math.floor(a/1e3),this.futureWsClient)}},{key:"sendQuery",value:function(t,e,a,n,c){JSON.stringify({req:"market.".concat(t,".kline.").concat(e),id:"id4",from:a,to:n})}},{key:"dataToEvents",value:function(t){return t.map((function(t,e){return new p.TimeEvent(new Date(1e3*t.id),t)}))}},{key:"updateData",value:function(t){console.log(t);var e=t.rep.match(/market\.([\w\-_]+)\.kline\.1day/);if(null!=e){var a=e[1],n=this.state.contractsDailySeries;n[a]=t.data;var c=this.state.nearContractDailySeries;null!=this.state.nearContract&&a==this.state.nearContract.contractCode&&(c=new p.TimeSeries({name:"near contract daily price",columns:["time","close"],events:this.dataToEvents(t.data)})),this.setState({contractsDailySeries:n,nearContractDailySeries:c})}}},{key:"render",value:function(){var t=this.state.contractsDailySeries[this.nearContractCode()],e=null;if(null!=t&&t.length>0){var a=this.state.nearContractDailySeries;e=Object(C.jsxs)("div",{children:[Object(C.jsxs)("h2",{children:[this.state.nearContract.contractCode," Close"]}),Object(C.jsx)(f.ChartContainer,{width:800,timeRange:a.range(),children:Object(C.jsxs)(f.ChartRow,{height:"200",children:[Object(C.jsx)(f.YAxis,{id:"price",label:"Price ($)",min:0,max:a.max("close"),width:"60",format:"$,.2f"}),Object(C.jsx)(f.Charts,{children:Object(C.jsx)(f.LineChart,{columns:["close"],axis:"price",series:a})})]})})]})}return Object(C.jsxs)("div",{children:[Object(C.jsxs)("h2",{children:[y(this.state.nearContract)," vs ",y(this.state.farContract)]}),e]})}}]),a}(n.Component),j=a(186);function O(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return Number.parseFloat(t).toPrecision(e)}var m=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(t){var n;Object(i.a)(this,a),n=e.call(this,t);for(var c={},r=["ETH","BTC"],o=0,u=r;o<u.length;o++){c[u[o]]=null}for(var d=["-USD","_CW","_NW","_CQ","_NQ"],h=[],b={},f=0,p=r;f<p.length;f++){var C,y=p[f],v=[],j=Object(s.a)(d);try{for(j.s();!(C=j.n()).done;){var O={contractCode:y+C.value};h.push(O),v.push(O)}}catch(m){j.e(m)}finally{j.f()}b[y]=v}return n.state={count:90,prices:c,symbols:r,future_contracts:[{contract_code:"ETH_CW",symbol:"ETH"},{contract_code:"ETH_NW",symbol:"ETH"},{contract_code:"ETH_CQ",symbol:"ETH"},{contract_code:"ETH_NQ",symbol:"ETH"},{contract_code:"BTC_CW",symbol:"BTC"},{contract_code:"BTC_NW",symbol:"BTC"},{contract_code:"BTC_CQ",symbol:"BTC"},{contract_code:"BTC_NQ",symbol:"BTC"}],historyData:{},currentPair:null,contracts:h,symbolContracts:b,openPrices:{}},n.sendMessage=n.sendMessage.bind(Object(l.a)(n)),n.subscribe=n.subscribe.bind(Object(l.a)(n)),n.updatePrice=n.updatePrice.bind(Object(l.a)(n)),n.sendMessageSwap=n.sendMessageSwap.bind(Object(l.a)(n)),n.queryFutureKlineData=n.queryFutureKlineData.bind(Object(l.a)(n)),n.onClickMarketData=n.onClickMarketData.bind(Object(l.a)(n)),n.compareContracts=n.compareContracts.bind(Object(l.a)(n)),n.updateOpenPrice=n.updateOpenPrice.bind(Object(l.a)(n)),n}return Object(o.a)(a,[{key:"queryFutureKlineData",value:function(t,e,a,n){var c=JSON.stringify({req:"market.".concat(t,".kline.").concat(e),id:"id4",from:a,to:n});this.sendMessage(c),this.sendMessageSwap(c)}},{key:"onClickMarketData",value:function(){console.log("onClickMarketData"),this.queryFutureKlineData("ETH_CQ","1min",0,1)}},{key:"componentDidMount",value:function(){var t,e=Object(s.a)(this.state.symbols);try{for(e.s();!(t=e.n()).done;)t.value}catch(a){e.e(a)}finally{e.f()}}},{key:"handleData",value:function(t){var e=this.sendMessage,a=this;t.arrayBuffer().then((function(t){var n=j.inflate(t,{to:"string"}),c=JSON.parse(n);if(c.ping)e(JSON.stringify({pong:c.ping}));else if(c.tick){var r=c.ch.match(/market\.([\w_]+)\.kline\.(.*)/);if(r){var s=r[1];a.updatePrice(s,c.tick.close),"1day"==r[2]&&a.updateOpenPrice(s,c.tick.open)}}else c.rep&&null!=a.compareView&&a.compareView.updateData(c)}))}},{key:"updatePrice",value:function(t,e){var a=this.state.prices;a[t]=e,this.setState({prices:a})}},{key:"subscribe",value:function(){var t,e=Object(s.a)(this.state.symbols);try{for(e.s();!(t=e.n()).done;)for(var a=t.value,n=0,c=["CW","NW","CQ","NQ"];n<c.length;n++){var r=c[n];this.sendMessage(JSON.stringify({sub:"market.".concat(a,"_").concat(r,".kline.1day"),id:"".concat(a,"_").concat(r)}))}}catch(i){e.e(i)}finally{e.f()}}},{key:"handleOpen",value:function(){this.subscribe()}},{key:"sendMessage",value:function(t){this.refWebSocket.sendMessage(t)}},{key:"handleSwapOpen",value:function(){var t,e=new Set,a=Object(s.a)(this.state.future_contracts);try{for(a.s();!(t=a.n()).done;){var n=t.value;e.add(n.symbol)}}catch(u){a.e(u)}finally{a.f()}var c,r=Object(s.a)(e);try{for(r.s();!(c=r.n()).done;){var i=c.value,o="".concat(i,"-USD"),l="market.".concat(o,".kline.1day");this.sendMessageSwap(JSON.stringify({sub:l}))}}catch(u){r.e(u)}finally{r.f()}}},{key:"sendMessageSwap",value:function(t){this.ws_swap.sendMessage(t)}},{key:"updateOpenPrice",value:function(t,e){var a=this.state.openPrices;a[t]=e,this.setState({openPrices:a})}},{key:"handleSwapReceive",value:function(t){var e=this;t.arrayBuffer().then((function(t){var a=j.inflate(t,{to:"string"}),n=JSON.parse(a);if(n.ping)e.sendMessageSwap(JSON.stringify({pong:n.ping}));else if(n.tick){var c=n.ch.match(/market\.(([\w]+)\-([\w+]+))\.kline\.(.*)/);if(c){var r=c[2],s=c[1];"1day"==c[4]&&e.updateOpenPrice(s,n.tick.open),e.updatePrice(r,n.tick.close),e.updatePrice(s,n.tick.close)}else n.req&&e.compareView.updateData(n)}}))}},{key:"compareContracts",value:function(t,e){console.log(t+" vs "+e),this.compareView.setContracts(t,e);var a=Date.now(),n=Math.floor(a/1e3-1209600),c=Math.floor(a/1e3);this.queryFutureKlineData(t.contractCode,"1day",n,c),this.queryFutureKlineData(e.contractCode,"1day",n,c)}},{key:"render",value:function(){var t=this,e=(this.state.symbols,this.state.future_contracts,this.state.symbolContracts),a=Object(C.jsx)(b.a,{url:"wss://api.btcgateway.pro/ws",onMessage:this.handleData.bind(this),debug:!0,onOpen:this.handleOpen.bind(this),ref:function(e){t.refWebSocket=e}});return Object(C.jsxs)("div",{children:[Object.keys(e).map((function(a,n){return Object(C.jsxs)("table",{symbol:a,children:[Object(C.jsx)("thead",{children:Object(C.jsxs)("tr",{children:[Object(C.jsx)("td",{}),Object(C.jsx)("td",{}),e[a].map((function(t,e){return Object(C.jsx)("td",{children:t.contractCode},t.contractCode)}))]})}),Object(C.jsx)("tbody",{children:e[a].map((function(n,c){return Object(C.jsxs)("tr",{children:[Object(C.jsx)("td",{children:n.contractCode}),Object(C.jsxs)("td",{children:[O(t.state.prices[n.contractCode]),"(",O(100*(t.state.prices[n.contractCode]/t.state.openPrices[n.contractCode]-1),3),"%)"]}),e[a].map((function(e,a){return Object(C.jsxs)("td",{onClick:function(){return t.compareContracts(n,e)},children:[(t.state.prices[n.contractCode]-t.state.prices[e.contractCode]).toFixed(4),"(",(t.state.prices[n.contractCode]/t.state.prices[e.contractCode]).toFixed(4),")"]})}))]},n.contract)}))})]})})),a,Object(C.jsx)(b.a,{url:"wss://api.btcgateway.pro/swap-ws",onMessage:this.handleSwapReceive.bind(this),debug:!0,onOpen:this.handleSwapOpen.bind(this),ref:function(e){t.ws_swap=e}}),Object(C.jsx)(v,{ref:function(e){return t.compareView=e},futureWsClient:a,swapWsClient:this.ws_swap})]})}}]),a}(n.Component),k=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,189)).then((function(e){var a=e.getCLS,n=e.getFID,c=e.getFCP,r=e.getLCP,s=e.getTTFB;a(t),n(t),c(t),r(t),s(t)}))};r.a.render(Object(C.jsx)(m,{}),document.getElementById("root")),k()}},[[187,1,2]]]);
//# sourceMappingURL=main.94cefde0.chunk.js.map